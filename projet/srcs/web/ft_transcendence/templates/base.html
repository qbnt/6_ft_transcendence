{% load static %}

<!DOCTYPE html>
<html lang="fr">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<script src="https://unpkg.com/htmx.org@1.9.2"></script>
	<script src="https://unpkg.com/hyperscript.org@0.9.12"></script>
	<script src="https://unpkg.com/htmx.org@1.9.12/dist/ext/ws.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

	<title>{% block title %}ft_transcendence{% endblock %}</title>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<link rel="stylesheet" href="{% static 'global.css' %}">
	<link rel="icon" href="{% static 'favicon.ico' %}">
</head>

<body>
	<header>
		<a href="{% url 'home:index' %}">
			<img src="{% static 'images/logo.png' %}" alt="Logo" id="logo">
		</a>
	</header>

	<nav class="navbar-container">
		<button class="navbar-toggle">
			<img src="{% static 'images/menu-icon.png' %}" alt="Menu" class="menu-icon">
		</button>
		<nav class="navbar">
			<section class="profil">
				{% if request.user.is_authenticated %}
					<div class="mid-pp">
						<a href="{% url 'user_manage:profile' request.user.username %}">
							<img src="{{ request.user.avatar.url }}" alt="Image Profil">
						</a>
					</div>
				{% else %}
					<div class="pp-container">
						<a href="{% url 'user_manage:connexion' %}">
							<img src="{% static 'images/default_avatar.jpg' %}" alt="Image de connexion">
						</a>
					</div>
				{% endif %}
			</section>
			<section class="search">
				<form action="{% url 'user_manage:search' %}" method="get" class="search-form">
					<input type="text" name="query" placeholder="Rechercher un utilisateur..." class="search-input">
					<button type="submit" class="search-button">
						<img src="{% static 'images/loupe.png' %}" alt="Rechercher" class="search-icon">
					</button>
				</form>
			</section>
		</nav>
	</nav>

	<section class="socialbar">
		{% if request.user.is_authenticated %}
			<div id="friend_list" class="socialbar-item">
				<h3>Liste d'amis</h3>
				<ul>
					{% for friend in user.friends.all %}
						<div class="friend">
							<li>
								<div class="mini-pp">
									<img src="{{ friend.avatar.url }}" alt="friend pp">
								</div>
								<a href="{% url 'user_manage:profile' friend.username %}">{{ friend.username }}</a>
							</li>
						</div>
					{% endfor %}
				</ul>
			</div>
			<div id="chat" class="socialbar-item">
				<h3>Live Chat</h3>
				<ul>
					<li><a href="{% url 'chat:chat_view' %}">Channel publique</a></li>
					{% for chatroom in user.chat_groups.all %}
						{% if chatroom.is_private %}
							{% for member in chatroom.members.all %}
								{% if member != user %}
									<li><a href="{% url 'chat:chatroom' chatroom.group_name %}">{{ member.username }}</a></li>
								{% endif %}
							{%endfor %}
						{% endif %}
					{% endfor %}
				</ul>
			</div>
		{% endif %}
	</section>

	<main>
		<section id="syst_messages">
			{% for message in messages %}
				<p>{{ message }}</p>
			{% endfor %}
		</section>
		<section id="game">
			{% block game %}
			{% endblock %}
		</section>
		<section id="content">
			{% block content %}
			{% endblock %}
		</section>
	</main>

	<footer>
		<p>&copy; 2024 ft_transcendence</p>
		{% block javascript %}
		{% endblock%}
		<script>
			document.querySelector('.navbar-toggle').addEventListener('click', function() {
				document.querySelector('.navbar').classList.toggle('active');
			});
		</script>
	</footer>
</body>

</html>